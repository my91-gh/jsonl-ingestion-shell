<?xml version="1.0" encoding="UTF-8"?>
<bundle-app xmlns="uri:oozie:bundle:0.2" name="jsonl-ingestion-bundle">
    
    <!-- Coordinateur pour l'analyse des fichiers d'entrée -->
    <coordinator name="analyzer-coord">
        <app-path>${nameNode}/user/${wf:user()}/jsonl-ingestion/coordinator/analyzer-coordinator.xml</app-path>
        <configuration>
            <property>
                <name>jobTracker</name>
                <value>${jobTracker}</value>
            </property>
            <property>
                <name>nameNode</name>
                <value>${nameNode}</value>
            </property>
            <property>
                <name>queueName</name>
                <value>${queueName}</value>
            </property>
            <property>
                <name>appPath</name>
                <value>${appPath}</value>
            </property>
            <property>
                <name>inputPath</name>
                <value>${inputPath}</value>
            </property>
            <property>
                <name>chunkListDir</name>
                <value>${chunkListDir}</value>
            </property>
            <property>
                <name>chunkSize</name>
                <value>${chunkSize}</value>
            </property>
            <property>
                <name>startTime</name>
                <value>${startTime}</value>
            </property>
            <property>
                <name>endTime</name>
                <value>${endTime}</value>
            </property>
        </configuration>
    </coordinator>
    
    <!-- Coordinateur pour le traitement des chunks -->
    <coordinator name="processor-coord">
        <app-path>${nameNode}/user/${wf:user()}/jsonl-ingestion/coordinator/processor-coordinator.xml</app-path>
        <configuration>
            <property>
                <name>jobTracker</name>
                <value>${jobTracker}</value>
            </property>
            <property>
                <name>nameNode</name>
                <value>${nameNode}</value>
            </property>
            <property>
                <name>queueName</name>
                <value>${queueName}</value>
            </property>
            <property>
                <name>appPath</name>
                <value>${appPath}</value>
            </property>
            <property>
                <name>chunkListDir</name>
                <value>${chunkListDir}</value>
            </property>
            <property>
                <name>processedDir</name>
                <value>${chunkListDir}/processed</value>
            </property>
            <property>
                <name>sparkMaster</name>
                <value>${sparkMaster}</value>
            </property>
            <property>
                <name>sparkDriverMemory</name>
                <value>${sparkDriverMemory}</value>
            </property>
            <property>
                <name>sparkExecutorMemory</name>
                <value>${sparkExecutorMemory}</value>
            </property>
            <property>
                <name>startTime</name>
                <value>${startTime}</value>
            </property>
            <property>
                <name>endTime</name>
                <value>${endTime}</value>
            </property>
        </configuration>
    </coordinator>
    
    <!-- Coordinateur pour la vérification de la finalisation du traitement -->
    <coordinator name="dependency-coord">
        <app-path>${nameNode}/user/${wf:user()}/jsonl-ingestion/coordinator/dependency-coordinator.xml</app-path>
        <configuration>
            <property>
                <name>jobTracker</name>
                <value>${jobTracker}</value>
            </property>
            <property>
                <name>nameNode</name>
                <value>${nameNode}</value>
            </property>
            <property>
                <name>queueName</name>
                <value>${queueName}</value>
            </property>
            <property>
                <name>appPath</name>
                <value>${appPath}</value>
            </property>
            <property>
                <name>chunkListDir</name>
                <value>${chunkListDir}</value>
            </property>
            <property>
                <name>processedDir</name>
                <value>${chunkListDir}/processed</value>
            </property>
            <property>
                <name>processorDoneFlag</name>
                <value>${processorDoneFlag}</value>
            </property>
            <property>
                <name>startTime</name>
                <value>${startTime}</value>
            </property>
            <property>
                <name>endTime</name>
                <value>${endTime}</value>
            </property>
        </configuration>
    </coordinator>
    
    <!-- Coordinateur pour la fusion des résultats -->
    <coordinator name="merger-coord">
        <app-path>${nameNode}/user/${wf:user()}/jsonl-ingestion/coordinator/merger-coordinator.xml</app-path>
        <configuration>
            <property>
                <name>jobTracker</name>
                <value>${jobTracker}</value>
            </property>
            <property>
                <name>nameNode</name>
                <value>${nameNode}</value>
            </property>
            <property>
                <name>queueName</name>
                <value>${queueName}</value>
            </property>
            <property>
                <name>appPath</name>
                <value>${appPath}</value>
            </property>
            <property>
                <name>chunkListDir</name>
                <value>${chunkListDir}</value>
            </property>
            <property>
                <name>processedDir</name>
                <value>${chunkListDir}/processed</value>
            </property>
            <property>
                <name>outputDir</name>
                <value>${outputDir}</value>
            </property>
            <property>
                <name>sparkMaster</name>
                <value>${sparkMaster}</value>
            </property>
            <property>
                <name>sparkDriverMemory</name>
                <value>${sparkDriverMemory}</value>
            </property>
            <property>
                <name>sparkExecutorMemory</name>
                <value>${sparkExecutorMemory}</value>
            </property>
            <property>
                <name>startTime</name>
                <value>${startTime}</value>
            </property>
            <property>
                <name>endTime</name>
                <value>${endTime}</value>
            </property>
        </configuration>
    </coordinator>
    
</bundle-app>